# 学习记录

### 编写过程中用到的其他非预装的库

- 10.26
  - @type/node
- 10.27
  - @vue/shared:Vue.js官方共享库,包含在Vue源码中通用的工具函数,用于类型检查
  - lodash相关(生产依赖)
  - type-fest(开发依赖):增强TypeScript的类型系统,帮助处理复杂类型
- 10.29
  - 测试相关
    - @vue/test-utils: Vue.js官方提供的测试使用工具库,提供一组方便测试Vue组件的API
    - happy-dom: vitest测试脚本用到的依赖
    - jsdom @types/jsdom
    - unplugin-vue-macros
    - @vitejs/plugin-vue-jsx
  - @vueuse/core
    - type MaybeRef:用于处理可能是 ref 类型或者普通值的变量
  - async-validator: 用于表单验证的JS库,提供基于声明式规则的验证功能,可以同步或异步验证数据,广泛应用于vue和react中
  - normalize-wheel-es 用于标准化鼠标滚轮事件,滚轮事件在不同浏览器中表现不一致，特别是在滚动速率、方向和细节方面,这个包通过将原始的滚轮事件（wheel 或 mousewheel）标准化为统一的格式，使得在不同浏览器中获取一致的滚动行为变得更容易。

## 10月26日

模仿elementPlus，从源码上看，项目核心代码在packages包下，主要组件代码在components目录下。分析得出一个目录结构（以button为例）

```html
--packages --constants --components --__tests__ --src --style --index.ts
--theme-chalk --hooks --utils
```

先模仿这个结构写一个button组件

- 将组件中的常量放在constants目录下,今天设置了组件的尺寸常量(size.ts),明天从utils开始

## 10月27日

1. utils中buildProp的作用,优化Vue的prop类型的工具函数,用法与原本的prop基本一致
   - utils目录结构如下,buildProp从runtime.ts中逐层暴露给utils
   ```html
   --utils --__tests__ --vue --props --index.ts --runtime.ts --type.ts --util.ts
   --index.ts --icon.ts --index.ts --objects.ts --type.ts --typescript.ts
   ```
2. lodash库
   - isNil: 用于检查一个值是否为null或undefined

- 今天先将button.ts要导入的库和依赖准备好,包括类型定义和一些工具函数都是直接抄的,需要花时间好好理解一下为什么这么写！

## 10月28日

系统地学了一下typescript

## 10月29日

- 先学一下buildProp方法的实现
  1. 公用的类型检查函数放在utils/types.ts中, utils/vue/props/types.ts中提供prop相关的类型定义
  2. !! 强制将值转换为布尔值(负负得正但是布尔)
  3. 比较关键的两步
  - gpProp对象的构建
  - \_validator方法的定义
- button.ts
  1. 定义button有哪些类型,包括自定义的和原生的(buttonTypes,buttonTypes)
  2. 使用buildProps方法创建button的属性(buttonProps)
  3. buttonEmit
  4. 定义一些button相关的类型:ButtonProps、buttonEmits、ButtonType、ButtonNativeType、ButtonConfigContext
  - ExtractPropTypes:vue提供的类型工具,用于从组件的props定义中提取出TypeScript类型
- button.vue

  - 导入一个新的功能模块 useNamespace,在hooks目录下,主要作用是防止样式冲突、动态生成并规范化类名
  - 另一个新功能模块 useButton,在组件目录下,
  - 新功能模块 useDeprecated, hooks目录下,用于标记和提示不推荐使用的API或功能
  - 新功能工具 error.ts,utils目录下,用于错误提示
  - button有联合到config-provider和form两个组件,将这两个组件纳入下一步计划,另外还有一个button-custom,是有关button默认样式的逻辑

  今天把button组件的一些基本结构抄完了，有写到的功能也通过测试，默认class未通过,明日修复。

## 10月30日

- 先修复一下button的默认class为空的问题
  - ...class写成calss了。。。
- 开始写config-provider组件,之后在use-button中集成进去
  ```html
  --components --button --config-provider
  ```
- 补写一个组件非常关键的功能——install,在uitls/vue目录下

  ```html
  --utils --vue --install.ts
  ```

  - install用于将组件库的组件注册到Vue应用中. 遍历所有组件,将它们添加到Vue应用的组件列表中
  - utils目录下新建一个functions.ts,通过这个文件暴露两个@vue/shared中的方法:NOOP和toRawType,其中NOOP是install.ts中使用到的
  - utils/vue目录下新建一个typescript.ts,在其中定义一些类型,SFCWithInstall和SFCInstallWithContext是install.ts中要用到的
  - 开头的分号是一个防御性编程的做法，通常用于避免潜在的JS语法错误。如果前一行代码未正确结束,那下一行可能会受影响,使用分号避免这种情况
  - buttonGroup后期再完善
  - ?? 判断左侧是否为null或undefined,是则返回右边的值
  - vue的NOOP无操作函数(空函数)

  今天写了install功能,config-provider开了个头,config-provider还用到了message组件,也加入到开发队列中

## 10月31日

- 从hooks/use-global-config开始,新引入了几个hooks,同时写一下constants.ts和config-provider-props.ts
- 抄新增的hooks
  - useEmptyValuesProps
  - use-z-index
  - useLocale 这个设置国际化和语言的功能暂时放着
- utils新增isClient和isIOS判断

## 11月1日

- 才发现昨天已经把config-provider抄完了，除了国际化其他都ok，今天还是整理一下config-provider的实现吧
- 写测试的时候直接写dom一直报错,改用render函数写法
- 由于message用到其他组件的定义，直接给了个默认空对象类型，结果测试一直无法通过. setProps始终无法正确修改message属性
- config-provider写完，button中有关联的部分可以放出来了
- 新的测试发现button的autoInsertSpace应该有问题 明天再解决

## 11月2日

- use-namespace里的em方法写错了，应该是element。。。
- 由于jsx语法一直报错，虽然测试也能通过，但还是改成render函数
  - 改成render函数会有一个控制台警告Non-function value encountered for default slot. Prefer function slots for better performance.暂时忽略
- 正式开始写message组件
  - utils新增TypeComponents和TypeComponentsMap
  - constants新增EVENT_CODE
  - icon相关的暂时先直接用element的icons-vue包

## 11月3日

- message组件的method模块
- options报了个ts的错误，未找到原因

## 11月4日

- 因为button还是和form有关联,tooltip和dialog两个组件放到后面,今天开始实现form组件

## 11月5日

- async-validator库
- 源码中array.ts有一个ts报错 修改了一下
- 新增了几个hooks:use-id,use-prop
- 发现有很多地方都用到provide和inject做组件的通信

## 11月6日

- 今天先把form.vue抄完

## 11月7日

- form-item.vue
  - utils新增 addUnit,在utils/dom目录下,是一个新的dom类工具
  - 新增form-label-wrap组件,还是用tsx写的？
  - requireAsteriskPosition作用？
  - prop!:非空断言,告诉ts这个变量一定存在,从而跳过null和undefined的检查
  - utils新增 strings相关工具
- utils目录下还有几个ts错误 明天看看能不能解决

## 11月8日

- form-label-wrap.tsx

## 11月9日

- 今天开始写table组件
  - defineComponent里的directives、components等属性是干嘛用的 mousewheel事件？
- 根目录下新增directives目录,里面是一些自定义的指令,如mousewheel
  - 安装normalize-wheel-es
- 下一步计划是scrollbar组件

## 11月10日

- 今天把代码同步到githubde的仓库里
- store/helper.ts
- table-layout.ts
- table-header目录
  - 还用到checkbox组件(先放着)

### 梳理一下

- 以components下的button组件为起点，从button.ts开始编写，第一步从hooks目录导入useSizeProp对象
  - hooks目录如下,index.ts为目录的出口,负责导出所有hooks
    ```html
    -hooks -use-size -index.ts -index.ts
    ```
  - button组件要用的useSizeProp对象是通过buildProp方法得来的,同时它的values属性会有一个默认值
  - constants目录如下,同理index.ts为目录出口,size.ts里写的是组件size的常量以及一个组件size类型定义
    ```html
    -constants -size.ts -index.ts
    ```
  - utils目录比较复杂就不放在这了,每一级目录下也是通过index.ts将方法和类型暴露给上一级,而buildProp和buildProps方法写在utils/vue/props/runtime.ts中
  - button.ts中定义了一些button的属性、类型、事件
  - 新增use-namespace(hooks目录)
  - 新增use-button(组件目录)
  - 编写button组件基本的单元测试
  - mount vue提供的一个重要函数,用于挂载Vue组件以便测试,创建一个所提供组件的完整Vue实例,并将其插入到dom中
    - 接收两个参数,第一个参数是要渲染的组件,第二个参数是组件对应的一些选项
    - 返回一个包装器对象(wrapper),可以用这个对象来访问组件的DOM、方法、属性等
  - h(hyperscript) vue3中用于创建虚拟dom节点的函数,取代vue2中的jsx语法
    - 接收三个参数,要创建的元素类型(字符串(html标签)/组件对象);包含属性和事件的对象(可选);子节点(字符串/数组/虚拟节点)
    - 返回一个虚拟节点对象,用于描述要渲染的内容
